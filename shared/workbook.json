  {
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "SEEN-Manage and monitor",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "/subscriptions/<subscription>/resourceGroups/<rgname>/providers/Microsoft.OperationalInsights/workspaces/<workspacename>",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "storageUrl": {
      "type": "string",
      "defaultValue": "URL",
      "metadata": {
        "description": "The URL for the straoge account."
      }
    },
    "storageSas": {
      "type": "securestring",
      "defaultValue": "SAS",
      "metadata": {
        "description": "The Sas for the straoge account."
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "7bea244d-869b-45a8-996a-2472c0d7bc5f",
      "metadata": {
        "description": "Hardcoded GUID for this workbook"
      }
    },
    "ConfigLAId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Resouce id of the Config Logic App"
      }
    },
    "SendEMailLAId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Resouce id of the Send EMail Logic App"
      }
    }
  },
   "variables": {
      "workbookType": "workbook",
      "workbookSourceId": "Azure Monitor",
      "workbookId": "[parameters('workbookId')]",
      "workbookContent": {
        "version": "Notebook/1.0",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# SEEN Manage and monitor\r\n## ðŸ‘€ Security End-user Notification "
            },
            "name": "MainTitle"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a37fd215-135e-42dd-a8de-71a980fed282",
                  "version": "KqlParameterItem/1.0",
                  "name": "ListLogicApps",
                  "type": 5,
                  "isGlobal": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "Resources\r\n| where type == \"microsoft.logic/workflows\"\r\n| where properties.definition.parameters.ProjectName.defaultValue == \"SEEN\"\r\n| project id",
                  "crossComponentResources": [
                    "value::all"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "114bc411-3e1f-4e24-90e7-2d2773b88fb3",
                  "version": "KqlParameterItem/1.0",
                  "name": "CurrentConfig",
                  "type": 1,
                  "isGlobal": true,
                  "query": "[concat('externaldata ( Config:string ) [\"', parameters('storageUrl') ,'/seen/seen.config',  parameters('storageSas') ,'\"] with(format=\"txt\")\r\n| project Config')]",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "7538c735-9184-412f-8e47-a3484e318939",
                  "version": "KqlParameterItem/1.0",
                  "name": "ShowHelp",
                  "label": "Show help",
                  "type": 2,
                  "description": "Display/Hide the help text from the workbook",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\"value\":true,\"label\":\"Yes\",\"selected\":true},\r\n    {\"value\":\"no\",\"label\":\"No\"}\r\n]"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "WorkbookParameters"
          },
          {
            "type": 1,
            "content": {
              "json": "{CurrentConfig}"
            },
            "conditionalVisibility": {
              "parameterName": "ShowDebug",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DEBUG"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "246d10cb-ecc5-4ce0-9fe9-eecabbc966e7",
                  "cellValue": "VisibleTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Configuration",
                  "subTarget": "config",
                  "preText": "Configuration",
                  "style": "link"
                },
                {
                  "id": "904f613f-a255-41cf-93c4-5cd27d9eb9de",
                  "cellValue": "VisibleTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Statistics",
                  "subTarget": "stats",
                  "preText": "Statistics",
                  "style": "link"
                },
                {
                  "id": "0d6461b3-d53d-44a9-8cce-443452b76748",
                  "cellValue": "VisibleTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Templates",
                  "subTarget": "templates",
                  "style": "link"
                }
              ]
            },
            "name": "TabMenu"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| where type == \"microsoft.logic/workflows\"\r\n| where properties.definition.parameters.ProjectName.defaultValue == \"SEEN\"\r\n| extend Version = properties.definition.parameters.ModuleVersion.defaultValue\r\n| extend State = properties.state\r\n| extend Action = iif( State==\"Enabled\", \"disable\", \"enable\")",
              "size": 1,
              "title": "Enable the modules you want to use",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "name",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "type",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "tenantId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "kind",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "location",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "managedBy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "sku",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "plan",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "properties",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "tags",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "identity",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "zones",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "extendedLocation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Version",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Disabled",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ],
                      "armActionContext": {
                        "path": "[[\"id\"]/disable",
                        "headers": [],
                        "params": [
                          {
                            "key": "api-version",
                            "value": "2016-10-01"
                          }
                        ],
                        "httpMethod": "POST",
                        "description": "# Actions can potentially modify resources.\n## Please use caution and include a confirmation message in this description when authoring this command."
                      }
                    }
                  },
                  {
                    "columnMatch": "Action",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "ArmAction",
                      "linkIsContextBlade": true,
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "enable",
                          "representation": "Start",
                          "text": "Click here to enable"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Stop",
                          "text": "Click here to disable"
                        }
                      ],
                      "armActionContext": {
                        "path": "[[\"id\"]/[\"Action\"]",
                        "headers": [],
                        "params": [
                          {
                            "key": "api-version",
                            "value": "2016-10-01"
                          }
                        ],
                        "httpMethod": "POST",
                        "title": "You are about to [\"Action\"] [\"name\"]",
                        "description": "### Review the following actions before confirming\n\nYou want to **[\"Action\"]** the logic app **[\"name\"]**.\n\nNote that you will need to refresh the workbook to see the updated status.",
                        "actionName": "[[\"Action\"] [\"name\"]",
                        "runLabel": "Confirm"
                      },
                      "customColumnWidthSetting": "25ch"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "id",
                    "label": "Module"
                  },
                  {
                    "columnId": "resourceGroup",
                    "label": "Resource Group"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "config"
            },
            "name": "ListModules"
          },
          {
            "type": 1,
            "content": {
              "json": "### SEEN Configuration\r\n\r\nEdit the settings and click **Save the configuration** once you are done. "
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "config"
            },
            "name": "ConfigTitle"
          },
          {
            "type": 1,
            "content": {
              "json": "|Setting|Explanation|\r\n|---|---|\r\n|Mail From|The user principalname of the account you want to send the notifications from|\r\n|Time Zone|The time zone used to display the activity time in the notifications|\r\n|Test Email|The email to whom the notifications are sent when the modules are in Test Mode|\r\n|Suppor Email|The email address listed as a point of contact for questions and support in the notifications|\r\n|Support Phone|The phone number listed as a point of contact for questions and support in the notifications| \r\n|Notify when new version|Notify the admin when a new version of SEEN is available| \r\n|Admin Email|The email address of the admin to notify when a new version is available| "
            },
            "conditionalVisibilities": [
              {
                "parameterName": "VisibleTab",
                "comparison": "isEqualTo",
                "value": "config"
              },
              {
                "parameterName": "ShowHelp",
                "comparison": "isEqualTo",
                "value": "true"
              }
            ],
            "name": "ConfigHelp"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "5f9bbb2e-b229-485f-8a37-157538c4e636",
                  "version": "KqlParameterItem/1.0",
                  "name": "mailFrom",
                  "label": "Mail From",
                  "type": 1,
                  "isGlobal": true,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.mailFrom\",\"columns\":[]}}]}",
                  "typeSettings": {
                    "paramValidationRules": [
                      {
                        "regExp": "^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$",
                        "match": true,
                        "message": "Enter a valid email address"
                      }
                    ]
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 8
                },
                {
                  "id": "b4cf232b-9920-4d35-b2d9-bb6506f88601",
                  "version": "KqlParameterItem/1.0",
                  "name": "timeZone",
                  "label": "Time Zone",
                  "type": 2,
                  "isGlobal": true,
                  "query": "let ListTZ = datatable(TimeZone:string) [\"Africa/Abidjan\",\"Africa/Accra\",\"Africa/Addis_Ababa\",\"Africa/Algiers\",\"Africa/Asmara\",\"Africa/Asmera\",\"Africa/Bamako\",\"Africa/Bangui\",\"Africa/Banjul\",\"Africa/Bissau\",\"Africa/Blantyre\",\"Africa/Brazzaville\",\"Africa/Bujumbura\",\"Africa/Cairo\",\"Africa/Casablanca\",\"Africa/Ceuta\",\"Africa/Conakry\",\"Africa/Dakar\",\"Africa/Dar_es_Salaam\",\"Africa/Djibouti\",\"Africa/Douala\",\"Africa/El_Aaiun\",\"Africa/Freetown\",\"Africa/Gaborone\",\"Africa/Harare\",\"Africa/Johannesburg\",\"Africa/Juba\",\"Africa/Kampala\",\"Africa/Khartoum\",\"Africa/Kigali\",\"Africa/Kinshasa\",\"Africa/Lagos\",\"Africa/Libreville\",\"Africa/Lome\",\"Africa/Luanda\",\"Africa/Lubumbashi\",\"Africa/Lusaka\",\"Africa/Malabo\",\"Africa/Maputo\",\"Africa/Maseru\",\"Africa/Mbabane\",\"Africa/Mogadishu\",\"Africa/Monrovia\",\"Africa/Nairobi\",\"Africa/Ndjamena\",\"Africa/Niamey\",\"Africa/Nouakchott\",\"Africa/Ouagadougou\",\"Africa/Porto-Novo\",\"Africa/Sao_Tome\",\"Africa/Timbuktu\",\"Africa/Tripoli\",\"Africa/Tunis\",\"Africa/Windhoek\",\"America/Adak\",\"America/Anchorage\",\"America/Anguilla\",\"America/Antigua\",\"America/Araguaina\",\"America/Argentina/Buenos_Aires\",\"America/Argentina/Catamarca\",\"America/Argentina/ComodRivadavia\",\"America/Argentina/Cordoba\",\"America/Argentina/Jujuy\",\"America/Argentina/La_Rioja\",\"America/Argentina/Mendoza\",\"America/Argentina/Rio_Gallegos\",\"America/Argentina/Salta\",\"America/Argentina/San_Juan\",\"America/Argentina/San_Luis\",\"America/Argentina/Tucuman\",\"America/Argentina/Ushuaia\",\"America/Aruba\",\"America/Asuncion\",\"America/Atikokan\",\"America/Atka\",\"America/Bahia\",\"America/Bahia_Banderas\",\"America/Barbados\",\"America/Belem\",\"America/Belize\",\"America/Blanc-Sablon\",\"America/Boa_Vista\",\"America/Bogota\",\"America/Boise\",\"America/Buenos_Aires\",\"America/Cambridge_Bay\",\"America/Campo_Grande\",\"America/Cancun\",\"America/Caracas\",\"America/Catamarca\",\"America/Cayenne\",\"America/Cayman\",\"America/Chicago\",\"America/Chihuahua\",\"America/Coral_Harbour\",\"America/Cordoba\",\"America/Costa_Rica\",\"America/Creston\",\"America/Cuiaba\",\"America/Curacao\",\"America/Danmarkshavn\",\"America/Dawson\",\"America/Dawson_Creek\",\"America/Denver\",\"America/Detroit\",\"America/Dominica\",\"America/Edmonton\",\"America/Eirunepe\",\"America/El_Salvador\",\"America/Ensenada\",\"America/Fort_Nelson\",\"America/Fort_Wayne\",\"America/Fortaleza\",\"America/Glace_Bay\",\"America/Godthab\",\"America/Goose_Bay\",\"America/Grand_Turk\",\"America/Grenada\",\"America/Guadeloupe\",\"America/Guatemala\",\"America/Guayaquil\",\"America/Guyana\",\"America/Halifax\",\"America/Havana\",\"America/Hermosillo\",\"America/Indiana/Indianapolis\",\"America/Indiana/Knox\",\"America/Indiana/Marengo\",\"America/Indiana/Petersburg\",\"America/Indiana/Tell_City\",\"America/Indiana/Vevay\",\"America/Indiana/Vincennes\",\"America/Indiana/Winamac\",\"America/Indianapolis\",\"America/Inuvik\",\"America/Iqaluit\",\"America/Jamaica\",\"America/Jujuy\",\"America/Juneau\",\"America/Kentucky/Louisville\",\"America/Kentucky/Monticello\",\"America/Knox_IN\",\"America/Kralendijk\",\"America/La_Paz\",\"America/Lima\",\"America/Los_Angeles\",\"America/Louisville\",\"America/Lower_Princes\",\"America/Maceio\",\"America/Managua\",\"America/Manaus\",\"America/Marigot\",\"America/Martinique\",\"America/Matamoros\",\"America/Mazatlan\",\"America/Mendoza\",\"America/Menominee\",\"America/Merida\",\"America/Metlakatla\",\"America/Mexico_City\",\"America/Miquelon\",\"America/Moncton\",\"America/Monterrey\",\"America/Montevideo\",\"America/Montreal\",\"America/Montserrat\",\"America/Nassau\",\"America/New_York\",\"America/Nipigon\",\"America/Nome\",\"America/Noronha\",\"America/North_Dakota/Beulah\",\"America/North_Dakota/Center\",\"America/North_Dakota/New_Salem\",\"America/Nuuk\",\"America/Ojinaga\",\"America/Panama\",\"America/Pangnirtung\",\"America/Paramaribo\",\"America/Phoenix\",\"America/Port-au-Prince\",\"America/Port_of_Spain\",\"America/Porto_Acre\",\"America/Porto_Velho\",\"America/Puerto_Rico\",\"America/Punta_Arenas\",\"America/Rainy_River\",\"America/Rankin_Inlet\",\"America/Recife\",\"America/Regina\",\"America/Resolute\",\"America/Rio_Branco\",\"America/Rosario\",\"America/Santa_Isabel\",\"America/Santarem\",\"America/Santiago\",\"America/Santo_Domingo\",\"America/Sao_Paulo\",\"America/Scoresbysund\",\"America/Shiprock\",\"America/Sitka\",\"America/St_Barthelemy\",\"America/St_Johns\",\"America/St_Kitts\",\"America/St_Lucia\",\"America/St_Thomas\",\"America/St_Vincent\",\"America/Swift_Current\",\"America/Tegucigalpa\",\"America/Thule\",\"America/Thunder_Bay\",\"America/Tijuana\",\"America/Toronto\",\"America/Tortola\",\"America/Vancouver\",\"America/Virgin\",\"America/Whitehorse\",\"America/Winnipeg\",\"America/Yakutat\",\"America/Yellowknife\",\"Antarctica/Casey\",\"Antarctica/Davis\",\"Antarctica/DumontDUrville\",\"Antarctica/Macquarie\",\"Antarctica/Mawson\",\"Antarctica/McMurdo\",\"Antarctica/Palmer\",\"Antarctica/Rothera\",\"Antarctica/South_Pole\",\"Antarctica/Syowa\",\"Antarctica/Troll\",\"Antarctica/Vostok\",\"Arctic/Longyearbyen\",\"Asia/Aden\",\"Asia/Almaty\",\"Asia/Amman\",\"Asia/Anadyr\",\"Asia/Aqtau\",\"Asia/Aqtobe\",\"Asia/Ashgabat\",\"Asia/Ashkhabad\",\"Asia/Atyrau\",\"Asia/Baghdad\",\"Asia/Bahrain\",\"Asia/Baku\",\"Asia/Bangkok\",\"Asia/Barnaul\",\"Asia/Beirut\",\"Asia/Bishkek\",\"Asia/Brunei\",\"Asia/Kolkata\",\"Asia/Chita\",\"Asia/Choibalsan\",\"Asia/Chongqing\",\"Asia/Colombo\",\"Asia/Dacca\",\"Asia/Damascus\",\"Asia/Dhaka\",\"Asia/Dili\",\"Asia/Dubai\",\"Asia/Dushanbe\",\"Asia/Famagusta\",\"Asia/Gaza\",\"Asia/Harbin\",\"Asia/Hebron\",\"Asia/Ho_Chi_Minh_City\",\"Asia/Hong_Kong\",\"Asia/Hovd\",\"Asia/Irkutsk\",\"Asia/Istanbul\",\"Asia/Jakarta\",\"Asia/Jayapura\",\"Asia/Jerusalem\",\"Asia/Kabul\",\"Asia/Kamchatka\",\"Asia/Karachi\",\"Asia/Kashgar\",\"Asia/Kathmandu\",\"Asia/Katmandu\",\"Asia/Khandyga\",\"Asia/Kolkata\",\"Asia/Krasnoyarsk\",\"Asia/Kuala_Lumpur\",\"Asia/Kuching\",\"Asia/Kuwait\",\"Asia/Macao\",\"Asia/Macau\",\"Asia/Magadan\",\"Asia/Makassar\",\"Asia/Manila\",\"Asia/Muscat\",\"Asia/Nicosia\",\"Asia/Novokuznetsk\",\"Asia/Novosibirsk\",\"Asia/Omsk\",\"Asia/Oral\",\"Asia/Phnom_Penh\",\"Asia/Pontianak\",\"Asia/Pyongyang\",\"Asia/Qatar\",\"Asia/Qostanay\",\"Asia/Qyzylorda\",\"Asia/Yangon (Rangoon)\",\"Asia/Riyadh\",\"Asia/Sakhalin\",\"Asia/Samarkand\",\"Asia/Seoul\",\"Asia/Shanghai\",\"Asia/Singapore\",\"Asia/Srednekolymsk\",\"Asia/Taipei\",\"Asia/Tashkent\",\"Asia/Tbilisi\",\"Asia/Tehran\",\"Asia/Tel_Aviv\",\"Asia/Thimbu\",\"Asia/Thimphu\",\"Asia/Tokyo\",\"Asia/Tomsk\",\"Asia/Ujung_Pandang\",\"Asia/Ulaanbaatar\",\"Asia/Ulan_Bator\",\"Asia/Urumqi\",\"Asia/Ust-Nera\",\"Asia/Vientiane\",\"Asia/Vladivostok\",\"Asia/Yakutsk\",\"Asia/Yangon\",\"Asia/Yekaterinburg\",\"Asia/Yerevan\",\"Atlantic/Azores\",\"Atlantic/Bermuda\",\"Atlantic/Canary\",\"Atlantic/Cape_Verde\",\"Atlantic/Faeroe\",\"Atlantic/Faroe\",\"Atlantic/Jan_Mayen\",\"Atlantic/Madeira\",\"Atlantic/Reykjavik\",\"Atlantic/South_Georgia\",\"Atlantic/St_Helena\",\"Atlantic/Stanley\",\"Australia/ACT\",\"Australia/Adelaide\",\"Australia/Brisbane\",\"Australia/Broken_Hill\",\"Australia/Canberra\",\"Australia/Currie\",\"Australia/Darwin\",\"Australia/Eucla\",\"Australia/Hobart\",\"Australia/LHI\",\"Australia/Lindeman\",\"Australia/Lord_Howe\",\"Australia/Melbourne\",\"Australia/NSW\",\"Australia/North\",\"Australia/Perth\",\"Australia/Queensland\",\"Australia/South\",\"Australia/Sydney\",\"Australia/Tasmania\",\"Australia/Victoria\",\"Australia/West\",\"Australia/Yancowinna\",\"Brazil/Acre\",\"Brazil/DeNoronha\",\"Brazil/East\",\"Brazil/West\",\"CET\",\"CST6CDT\",\"Canada/Atlantic\",\"Canada/Central\",\"Canada/Eastern\",\"Canada/Mountain\",\"Canada/Newfoundland\",\"Canada/Pacific\",\"Canada/Saskatchewan\",\"Canada/Yukon\",\"Chile/Continental\",\"Chile/EasterIsland\",\"Cuba\",\"EET\",\"EST\",\"EST5EDT\",\"Egypt\",\"Eire\",\"Etc/GMT\",\"Etc/GMT+0\",\"Etc/GMT+1\",\"Etc/GMT+10\",\"Etc/GMT+11\",\"Etc/GMT+12\",\"Etc/GMT+2\",\"Etc/GMT+3\",\"Etc/GMT+4\",\"Etc/GMT+5\",\"Etc/GMT+6\",\"Etc/GMT+7\",\"Etc/GMT+8\",\"Etc/GMT+9\",\"Etc/GMT-0\",\"Etc/GMT-1\",\"Etc/GMT-10\",\"Etc/GMT-11\",\"Etc/GMT-12\",\"Etc/GMT-13\",\"Etc/GMT-14\",\"Etc/GMT-2\",\"Etc/GMT-3\",\"Etc/GMT-4\",\"Etc/GMT-5\",\"Etc/GMT-6\",\"Etc/GMT-7\",\"Etc/GMT-8\",\"Etc/GMT-9\",\"Etc/GMT0\",\"Etc/Greenwich\",\"Etc/UCT\",\"Etc/UTC\",\"Etc/Universal\",\"Etc/Zulu\",\"Europe/Amsterdam\",\"Europe/Andorra\",\"Europe/Astrakhan\",\"Europe/Athens\",\"Europe/Belfast\",\"Europe/Belgrade\",\"Europe/Berlin\",\"Europe/Bratislava\",\"Europe/Brussels\",\"Europe/Bucharest\",\"Europe/Budapest\",\"Europe/Busingen\",\"Europe/Chisinau\",\"Europe/Copenhagen\",\"Europe/Dublin\",\"Europe/Gibraltar\",\"Europe/Guernsey\",\"Europe/Helsinki\",\"Europe/Isle_of_Man\",\"Europe/Istanbul\",\"Europe/Jersey\",\"Europe/Kaliningrad\",\"Europe/Kyiv\",\"Europe/Kirov\",\"Europe/Lisbon\",\"Europe/Ljubljana\",\"Europe/London\",\"Europe/Luxembourg\",\"Europe/Madrid\",\"Europe/Malta\",\"Europe/Mariehamn\",\"Europe/Minsk\",\"Europe/Monaco\",\"Europe/Moscow\",\"Europe/Nicosia\",\"Europe/Oslo\",\"Europe/Paris\",\"Europe/Podgorica\",\"Europe/Prague\",\"Europe/Riga\",\"Europe/Rome\",\"Europe/Samara\",\"Europe/San_Marino\",\"Europe/Sarajevo\",\"Europe/Saratov\",\"Europe/Simferopol\",\"Europe/Skopje\",\"Europe/Sofia\",\"Europe/Stockholm\",\"Europe/Tallinn\",\"Europe/Tirane\",\"Europe/Tiraspol\",\"Europe/Ulyanovsk\",\"Europe/Uzhgorod\",\"Europe/Vaduz\",\"Europe/Vatican\",\"Europe/Vienna\",\"Europe/Vilnius\",\"Europe/Volgograd\",\"Europe/Warsaw\",\"Europe/Zagreb\",\"Europe/Zaporozhye\",\"Europe/Zurich\",\"GB\",\"GB-Eire\",\"GMT\",\"GMT+0\",\"GMT-0\",\"GMT0\",\"Greenwich\",\"HST\",\"Hongkong\",\"Iceland\",\"Indian/Antananarivo\",\"Indian/Chagos\",\"Indian/Christmas\",\"Indian/Cocos\",\"Indian/Comoro\",\"Indian/Kerguelen\",\"Indian/Mahe\",\"Indian/Maldives\",\"Indian/Mauritius\",\"Indian/Mayotte\",\"Indian/Reunion\",\"Iran\",\"Israel\",\"Jamaica\",\"Japan\",\"Kwajalein\",\"Libya\",\"MET\",\"MST\",\"MST7MDT\",\"Mexico/BajaNorte\",\"Mexico/BajaSur\",\"Mexico/General\",\"NZ\",\"NZ-CHAT\",\"Navajo\",\"PRC\",\"PST8PDT\",\"Pacific/Apia\",\"Pacific/Auckland\",\"Pacific/Bougainville\",\"Pacific/Chatham\",\"Pacific/Chuuk\",\"Pacific/Easter\",\"Pacific/Efate\",\"Pacific/Enderbury\",\"Pacific/Fakaofo\",\"Pacific/Fiji\",\"Pacific/Funafuti\",\"Pacific/Galapagos\",\"Pacific/Gambier\",\"Pacific/Guadalcanal\",\"Pacific/Guam\",\"Pacific/Honolulu\",\"Pacific/Johnston\",\"Pacific/Kanton\",\"Pacific/Kiritimati\",\"Pacific/Kosrae\",\"Pacific/Kwajalein\",\"Pacific/Majuro\",\"Pacific/Marquesas\",\"Pacific/Midway\",\"Pacific/Nauru\",\"Pacific/Niue\",\"Pacific/Norfolk\",\"Pacific/Noumea\",\"Pacific/Pago_Pago\",\"Pacific/Palau\",\"Pacific/Pitcairn\",\"Pacific/Pohnpei\",\"Pacific/Ponape\",\"Pacific/Port_Moresby\",\"Pacific/Rarotonga\",\"Pacific/Saipan\",\"Pacific/Samoa\",\"Pacific/Tahiti\",\"Pacific/Tarawa\",\"Pacific/Tongatapu\",\"Pacific/Truk\",\"Pacific/Wake\",\"Pacific/Wallis\",\"Pacific/Yap\",\"Poland\",\"Portugal\",\"ROK\",\"Singapore\",\"TÃ¼rkiye\",\"UCT\",\"US/Alaska\",\"US/Aleutian\",\"US/Arizona\",\"US/Central\",\"US/East-Indiana\",\"US/Eastern\",\"US/Hawaii\",\"US/Indiana-Starke\",\"US/Michigan\",\"US/Mountain\",\"US/Pacific\",\"US/Samoa\",\"UTC\",\"Universal\",\"W-SU\",\"WET\",\"Zulu\"] ;\r\nListTZ\r\n| extend Selected = iif( TimeZone == \"{CurrentConfig:$.timeZone}\", true, false)\r\n| project value=TimeZone, label=TimeZone, selected=Selected",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "ed475d5d-f232-40bf-a274-35506e5b4bc0",
                  "version": "KqlParameterItem/1.0",
                  "name": "testEmail",
                  "label": "Test Email",
                  "type": 1,
                  "isGlobal": true,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.testEmail\",\"columns\":[]}}]}",
                  "typeSettings": {
                    "paramValidationRules": [
                      {
                        "regExp": "(^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$|^$)",
                        "match": true,
                        "message": "Enter a valid email address"
                      }
                    ]
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 8
                },
                {
                  "id": "7adfc8f0-a2a2-43b5-aff8-6c7633826ee8",
                  "version": "KqlParameterItem/1.0",
                  "name": "supportEmail",
                  "label": "Support Email",
                  "type": 1,
                  "isGlobal": true,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.contact.supportEmail\",\"columns\":[]}}]}",
                  "typeSettings": {
                    "paramValidationRules": [
                      {
                        "regExp": "^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$",
                        "match": true,
                        "message": "Enter a valid email address"
                      }
                    ]
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 8
                },
                {
                  "id": "b0f0925e-3d81-4557-96eb-f26aa052e6e5",
                  "version": "KqlParameterItem/1.0",
                  "name": "supportPhone",
                  "label": "Support Phone",
                  "type": 1,
                  "isGlobal": true,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.contact.supportPhone\",\"columns\":[]}}]}",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 8
                },
                {
                  "id": "50d64431-2955-46aa-bf06-56834092f1c0",
                  "version": "KqlParameterItem/1.0",
                  "name": "versionNotifyAdmin",
                  "label": "Notify when new version",
                  "type": 2,
                  "isGlobal": true,
                  "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.versionManagement.notifyAdmins}\", true, false)",
                  "typeSettings": {
                    "additionalResourceOptions": []
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "f54e7920-8e3e-4d45-9660-1181f07b2b76",
                  "version": "KqlParameterItem/1.0",
                  "name": "adminEmail",
                  "label": "Admin Email",
                  "type": 1,
                  "description": "The recipient who gets notifications when a new version of SEEN is available",
                  "isGlobal": true,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.versionManagement.adminEmail\",\"columns\":[]}}]}",
                  "typeSettings": {
                    "paramValidationRules": [
                      {
                        "regExp": "(^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$|^$)",
                        "match": true,
                        "message": "This must be a valid email address"
                      }
                    ]
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 8
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "config"
            },
            "name": "GeneralConfig"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "loadType": "always",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### MFA Module\r\n\r\nNotify the end-users when MFA methods get created, updated or deleted on their accounts."
                  },
                  "name": "MFAConfigTitle"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "|Setting|Explanation|\r\n|---|---|\r\n|Test Mode|When the module is set in test mode, it will not send the notifications to the end-users but to only to **{mailFrom}**|\r\n|Email Subject|The subject line for the MFA activities notification| \r\n|Copy to Manager|When enabled, sends a copy to the user's manager if it is defined in Azure AD| \r\n|BCC|Email address to who the email will be BCCed to. Only one email address is supported| \r\n|Include Guests|Also notify guest accounts (Azure B2B users) in your tenant| "
                  },
                  "conditionalVisibility": {
                    "parameterName": "ShowHelp",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "MFAConfigHelp"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "27d816a0-86fa-4dd6-a938-9b5a25fd945e",
                        "version": "KqlParameterItem/1.0",
                        "name": "mfa_testMode",
                        "label": "Test Mode",
                        "type": 2,
                        "isRequired": true,
                        "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.modules.mfa.testMode}\", true, false)",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "73bd317b-1a81-44f5-9cad-d0abe62cc8de",
                        "version": "KqlParameterItem/1.0",
                        "name": "mfa_subject",
                        "label": "Email Subject ",
                        "type": 1,
                        "isRequired": true,
                        "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.modules.mfa.subject\",\"columns\":[]}}]}",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 8
                      },
                      {
                        "id": "4c758f16-428f-4c48-a894-414cde0d20e0",
                        "version": "KqlParameterItem/1.0",
                        "name": "mfa_ccManager",
                        "label": "Copy to Manager",
                        "type": 2,
                        "isRequired": true,
                        "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.modules.mfa.ccManager}\", true, false)",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "17abd97e-8a4d-4c5a-b3d8-b8632c25a46c",
                        "version": "KqlParameterItem/1.0",
                        "name": "mfa_bcc",
                        "label": "BCC",
                        "type": 1,
                        "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.modules.mfa.bcc\",\"columns\":[]}}]}",
                        "typeSettings": {
                          "paramValidationRules": [
                            {
                              "regExp": "(^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$|^$)",
                              "match": true,
                              "message": ""
                            }
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 8
                      },
                      {
                        "id": "8dab7fe2-82b6-4bff-8d74-5c609aef3a8f",
                        "version": "KqlParameterItem/1.0",
                        "name": "mfa_includeGuests",
                        "label": "Include Guests",
                        "type": 2,
                        "isRequired": true,
                        "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.modules.mfa.includeGuests}\", true, false)",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "formHorizontal",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "MFAConfig"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "config"
            },
            "customWidth": "50",
            "name": "MFAGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "loadType": "always",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### TAP Module\r\n\r\nNotify the end-users when TAP get provisionned on their accounts."
                  },
                  "name": "TAPConfigTitle"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "|Setting|Explanation|\r\n|---|---|\r\n|Test Mode|When the module is set in test mode, it will not send the notifications to the end-users but to only to **{mailFrom}**|\r\n|Email Subject|The subject line for the MFA activities notification| \r\n|Copy to Manager|When enabled, sends a copy to the user's manager if it is defined in Azure AD| \r\n|BCC|Email address to who the email will be BCCed to. Only one email address is supported| \r\n|Inlcude TAP Usage|Also notify users when TAP are being used| "
                  },
                  "conditionalVisibility": {
                    "parameterName": "ShowHelp",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "TAPConfigHelp"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "42448f8f-0b85-43ca-9b98-caafeff1a02d",
                        "version": "KqlParameterItem/1.0",
                        "name": "tap_testMode",
                        "label": "Test Mode",
                        "type": 2,
                        "isRequired": true,
                        "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.modules.tap.testMode}\", true, false)",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "ac894fc2-dfd4-4f17-b693-356ca90edd98",
                        "version": "KqlParameterItem/1.0",
                        "name": "tap_subject",
                        "label": "Email Subject",
                        "type": 1,
                        "isRequired": true,
                        "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.modules.tap.subject\",\"columns\":[]}}]}",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 8
                      },
                      {
                        "id": "8ef96a06-ed3d-4fd6-b326-648162f84088",
                        "version": "KqlParameterItem/1.0",
                        "name": "tap_ccManager",
                        "label": "Copy to Manager",
                        "type": 2,
                        "isRequired": true,
                        "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.modules.tap.ccManager}\", true, false)",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "69d6413d-894e-4cda-876f-05ecf699b7da",
                        "version": "KqlParameterItem/1.0",
                        "name": "tap_bcc",
                        "label": "BCC",
                        "type": 1,
                        "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.modules.tap.bcc\",\"columns\":[]}}]}",
                        "typeSettings": {
                          "paramValidationRules": [
                            {
                              "regExp": "(^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$|^$)",
                              "match": true,
                              "message": ""
                            }
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 8
                      },
                      {
                        "id": "42be0b5c-ac91-4f58-a1a3-369e6ead4aaf",
                        "version": "KqlParameterItem/1.0",
                        "name": "tap_includeUsage",
                        "label": "Inlcude TAP Usage",
                        "type": 2,
                        "isRequired": true,
                        "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.modules.tap.includeUsage}\", true, false)",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "formHorizontal",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "TAPConfig"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "config"
            },
            "customWidth": "50",
            "name": "TAPGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "loadType": "always",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Travel Module\r\n\r\nNotify the end-users when atypical travels are detected on their accounts. This will only work if you have Azure AD P2 licenses on your Azure AD tenant."
                  },
                  "name": "TravelConfigTitle"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "|Setting|Explanation|\r\n|---|---|\r\n|Test Mode|When the module is set in test mode, it will not send the notifications to the end-users but to only to **{mailFrom}**|\r\n|Email Subject|The subject line for the MFA activities notification| \r\n|Copy to Manager|When enabled, sends a copy to the user's manager if it is defined in Azure AD| \r\n|BCC|Email address to who the email will be BCCed to. Only one email address is supported| \r\n|Inlcude Dismissed Risk|Also notify when users succesfuly performed MFA for this location| "
                  },
                  "conditionalVisibility": {
                    "parameterName": "ShowHelp",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "TravelConfigHelp"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "42448f8f-0b85-43ca-9b98-caafeff1a02d",
                        "version": "KqlParameterItem/1.0",
                        "name": "travel_testMode",
                        "label": "Test Mode",
                        "type": 2,
                        "isRequired": true,
                        "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.modules.travel.testMode}\", true, false)",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "ac894fc2-dfd4-4f17-b693-356ca90edd98",
                        "version": "KqlParameterItem/1.0",
                        "name": "travel_subject",
                        "label": "Email Subject",
                        "type": 1,
                        "isRequired": true,
                        "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.modules.travel.subject\",\"columns\":[]}}]}",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 8
                      },
                      {
                        "id": "8ef96a06-ed3d-4fd6-b326-648162f84088",
                        "version": "KqlParameterItem/1.0",
                        "name": "travel_ccManager",
                        "label": "Copy to Manager",
                        "type": 2,
                        "isRequired": true,
                        "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.modules.travel.ccManager}\", true, false)",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "69d6413d-894e-4cda-876f-05ecf699b7da",
                        "version": "KqlParameterItem/1.0",
                        "name": "travel_bcc",
                        "label": "BCC",
                        "type": 1,
                        "query": "{\"version\":\"1.0.0\",\"content\":\"{CurrentConfig}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.modules.travel.bcc\",\"columns\":[]}}]}",
                        "typeSettings": {
                          "paramValidationRules": [
                            {
                              "regExp": "(^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$|^$)",
                              "match": true,
                              "message": ""
                            }
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 8
                      },
                      {
                        "id": "42be0b5c-ac91-4f58-a1a3-369e6ead4aaf",
                        "version": "KqlParameterItem/1.0",
                        "name": "travel_includeDismissed",
                        "label": "Inlcude Dismissed Risks",
                        "type": 2,
                        "isRequired": true,
                        "query": "let Options = datatable(value:string,label:string,selected:bool) [\r\n\"true\",\"Enabled\",false,\r\n\"false\",\"Disabled\",false\r\n] ;\r\nOptions\r\n| extend selected = iif( value == \"{CurrentConfig:$.modules.travel.includeDismissed}\", true, false)",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "formHorizontal",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "TravelConfig"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "config"
            },
            "customWidth": "50",
            "name": "TravelGroup"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "toolbar",
              "links": [
                {
                  "id": "47643c20-6038-42c3-b79a-f27e39890ce6",
                  "linkTarget": "ArmAction",
                  "linkLabel": "Save the configuration",
                  "style": "link",
                  "icon": "Save",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "/subscriptions/12f5f23d-9ade-4a66-ad94-67cf1314f629/resourceGroups/MySeen/providers/Microsoft.Logic/workflows/SEEN-Config/triggers/manual/run",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2016-06-01"
                      }
                    ],
                    "body": "{\r\n  \"module\":\"config\",\r\n  \"config\":\r\n  {\r\n    \"version\":1,\r\n    \"versionManagement\": {\r\n        \"notifyAdmins\":{versionNotifyAdmin},\r\n        \"checkFrequencyInDays\":15,\r\n        \"adminEmail\":\"{adminEmail}\",\r\n        \"subject\":\"A new version of SEEN is available!\"\r\n    },\r\n    \"mailFrom\":\"{mailFrom}\",\r\n    \"replyTo\":\"{mailFrom}\",\r\n    \"saveToSentItems\":false,\r\n    \"timeZone\":\"{timeZone}\",\r\n    \"testEmail\":\"{testEmail}\",\r\n    \"contact\" : {\r\n        \"supportEmail\":\"{supportEmail}\",\r\n        \"supportPhone\": \"{supportPhone}\"\r\n    },\r\n    \"modules\": {\r\n        \"mfa\" : {\r\n            \"testMode\":{mfa_testMode},\r\n            \"subject\":\"{mfa_subject}\",\r\n            \"ccManager\":{mfa_ccManager},\r\n            \"bcc\":\"{mfa_bcc}\",\r\n            \"includeGuests\":{mfa_includeGuests}\r\n        },\r\n        \"tap\" : {\r\n            \"testMode\":{tap_testMode},\r\n            \"subject\":\"{tap_subject}\",\r\n            \"ccManager\":{tap_ccManager},\r\n            \"bcc\":\"{tap_bcc}\",\r\n            \"includeUsage\":{tap_includeUsage}\r\n        },\r\n        \"travel\" : {\r\n            \"testMode\":{travel_testMode},\r\n            \"subject\":\"{travel_subject}\",\r\n            \"ccManager\":{travel_ccManager},\r\n            \"bcc\":\"{travel_bcc}\",\r\n            \"includeDismissed\":{travel_includeDismissed}\r\n        } \r\n    }\r\n}\r\n}",
                    "httpMethod": "POST",
                    "title": "Update SEEN configuration",
                    "description": "### Review the following settings before confirming\n\n|Global Settings ||\n|---|---|\n|Mail From|{mailFrom}|\n|Time Zone|{timeZone}|\n|Test Email|{testEmail}|\n|Support Email|{supportEmail}|\n|Support Phone|{supportPhone}|\n|Notify admins of new version|{versionNotifyAdmin:label}|\n|Admin Email|{adminEmail}|\n\n\n|MFA Module ||\n|---|---|\n|Test Mode|{mfa_testMode:label}|\n|Email Subject|{mfa_subject}|\n|Copy Manager|{mfa_ccManager:label}|\n|BCC|{mfa_bcc}|\n|Include Guests|{mfa_includeGuests}|\n\n|TAP Module ||\n|---|---|\n|Test Mode|{tap_testMode:label}|\n|Email Subject|{tap_subject}|\n|Copy Manager|{tap_ccManager:label}|\n|BCC|{tap_bcc}|\n|Include Guests|{tap_includeUsage}|\n\n|Travel Module ||\n|---|---|\n|Test Mode|{travel_testMode:label}|\n|Email Subject|{travel_subject}|\n|Copy Manager|{travel_ccManager:label}|\n|BCC|{travel_bcc}|\n|Include Dismissed Risks|{travel_includeDismissed}|\n\nRefresh the workbook once the change is confirmed.",
                    "actionName": "Update SEEN configuration",
                    "runLabel": "Confirm the changes"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "config"
            },
            "name": "ToolbarButtons"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook7073068e-93e6-4191-b539-d09392d75b4b",
              "version": "MetricsItem/2.0",
              "size": 1,
              "chartType": 0,
              "resourceType": "microsoft.logic/workflows",
              "metricScope": 0,
              "resourceParameter": "ListLogicApps",
              "resourceIds": [
                "{ListLogicApps}"
              ],
              "timeContext": {
                "durationMs": 2592000000
              },
              "metrics": [
                {
                  "namespace": "microsoft.logic/workflows",
                  "metric": "microsoft.logic/workflows--RunsStarted",
                  "aggregation": 1
                },
                {
                  "namespace": "microsoft.logic/workflows",
                  "metric": "microsoft.logic/workflows--RunsSucceeded",
                  "aggregation": 1
                },
                {
                  "namespace": "microsoft.logic/workflows",
                  "metric": "microsoft.logic/workflows--RunsFailed",
                  "aggregation": 1
                },
                {
                  "namespace": "microsoft.logic/workflows",
                  "metric": "microsoft.logic/workflows--RunFailurePercentage",
                  "aggregation": 1
                },
                {
                  "namespace": "microsoft.logic/workflows",
                  "metric": "microsoft.logic/workflows--TotalBillableExecutions",
                  "aggregation": 1
                }
              ],
              "title": "Running Stats",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Name",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "microsoft.logic/workflows--RunsCompleted",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "rightContent": {
                  "columnMatch": "microsoft.logic/workflows--RunsCompleted Timeline",
                  "formatter": 9,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "showBorder": false,
                "sortCriteriaField": "Name",
                "size": "auto"
              },
              "mapSettings": {
                "locInfo": "AzureResource",
                "sizeSettings": "Value",
                "sizeAggregation": "Sum",
                "legendMetric": "Value",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "type": "heatmap",
                  "colorAggregation": "Sum",
                  "nodeColorField": "Value",
                  "heatmapPalette": "greenRed"
                },
                "locInfoColumn": "Name"
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "Subscription",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "Value",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Name",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunsStarted",
                    "formatter": 22,
                    "formatOptions": {
                      "aggregation": "Sum",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "microsoft.logic/workflows--RunsSucceeded",
                            "color": "green"
                          },
                          {
                            "columnName": "microsoft.logic/workflows--RunsFailed",
                            "color": "red"
                          }
                        ],
                        "noRowsScaling": true
                      }
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunsStarted Timeline",
                    "formatter": 21,
                    "formatOptions": {
                      "palette": "blue",
                      "aggregation": "Sum"
                    }
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunsSucceeded",
                    "formatter": 5,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunsSucceeded Timeline",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunsFailed",
                    "formatter": 5,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunsFailed Timeline",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunFailurePercentage",
                    "formatter": 1,
                    "formatOptions": {
                      "aggregation": "Average"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunFailurePercentage Timeline",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--TotalBillableExecutions",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue",
                      "aggregation": "Sum"
                    }
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--TotalBillableExecutions Timeline",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunsCompleted Timeline",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "microsoft.logic/workflows--RunsCompleted",
                    "formatter": 1,
                    "numberFormat": {
                      "unit": 0,
                      "options": null
                    }
                  }
                ],
                "rowLimit": 10000,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Subscription"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "Name"
                },
                "labelSettings": [
                  {
                    "columnId": "microsoft.logic/workflows--RunsStarted",
                    "label": "Total Runs"
                  },
                  {
                    "columnId": "microsoft.logic/workflows--RunsStarted Timeline",
                    "label": "Timeline"
                  },
                  {
                    "columnId": "microsoft.logic/workflows--RunsSucceeded",
                    "label": "Runs Succeeded (Sum)"
                  },
                  {
                    "columnId": "microsoft.logic/workflows--RunsSucceeded Timeline",
                    "label": "Runs Succeeded Timeline"
                  },
                  {
                    "columnId": "microsoft.logic/workflows--RunsFailed",
                    "label": "Runs Failed (Sum)"
                  },
                  {
                    "columnId": "microsoft.logic/workflows--RunsFailed Timeline",
                    "label": "Runs Failed Timeline"
                  },
                  {
                    "columnId": "microsoft.logic/workflows--RunFailurePercentage",
                    "label": "Failure Percentage"
                  },
                  {
                    "columnId": "microsoft.logic/workflows--RunFailurePercentage Timeline",
                    "label": "Run Failure Percentage Timeline"
                  },
                  {
                    "columnId": "microsoft.logic/workflows--TotalBillableExecutions",
                    "label": "Total Billable Executions (Sum)"
                  },
                  {
                    "columnId": "microsoft.logic/workflows--TotalBillableExecutions Timeline",
                    "label": "Total Billable Executions Timeline"
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "stats"
            },
            "name": "Running Stats"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AzureDiagnostics\r\n| where ResourceType == \"WORKFLOWS/RUNS/ACTIONS\"\r\n| where resource_workflowName_s =~ \"SEEN-SendNotification\"\r\n| where Resource == \"RESPONSE\"\r\n| where status_s == \"Succeeded\"\r\n| extend Module = column_ifexists(\"trackedProperties_Tracking_s\",\"\")\r\n| where isnotempty(Module)\r\n| extend Status = column_ifexists(\"trackedProperties_EmailStatus_d\",\"\")\r\n| extend Subject = column_ifexists(\"trackedProperties_EmailSubject_s\",\"\")\r\n| extend Sender = column_ifexists(\"trackedProperties_EmailFrom_s\",\"\")\r\n| extend Recipient = column_ifexists(\"trackedProperties_EmailRecipient_s\",\"\")\r\n| project TimeGenerated, Status, Subject, Sender , Recipient",
              "size": 0,
              "title": "List of email notifications",
              "noDataMessage": "No email sent yet or the diagnostic settings of the email logic app are not configured.",
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": ">",
                          "thresholdValue": "299",
                          "representation": "Mail",
                          "text": "ðŸŸ¥"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Mail",
                          "text": "ðŸŸ©"
                        }
                      ]
                    }
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "TimeGenerated",
                    "label": "Time Send"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "stats"
            },
            "name": "EmailStats"
          },
          {
            "type": 1,
            "content": {
              "json": "## Email templates"
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "templates"
            },
            "name": "TemplateTitle"
          },
          {
            "type": 1,
            "content": {
              "json": "Here are the possible key words:\r\n\r\n|Word|Replaced by|\r\n|---|---|\r\n|`{ Header }`|In the module emails, is replaced by the HTML header| \r\n|`{ Footer }`|In the module emails, is replaced by the HTML footer| \r\n|`{ UserFirstName }`|Is replaced by the first non null values: user's firstname or user's display name|\r\n|`{ SupportEmail }`|Is replaced by the support email from the configuration file| \r\n|`{ SupportPhoneNumber }`|Is replaced by the support phone number from the configuration file| \r\n|`{ Activities }`|The detected activities in an HTML table|  \r\n|`{ VersionTable }`|The table with the info on the latest version of SEEN (only used in the new version notification email)|  "
            },
            "conditionalVisibilities": [
              {
                "parameterName": "VisibleTab",
                "comparison": "isEqualTo",
                "value": "templates"
              },
              {
                "parameterName": "ShowHelp",
                "comparison": "isEqualTo",
                "value": "true"
              }
            ],
            "name": "TemplateHelp"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "33c75ece-fc44-417a-a46e-fa57d11070ee",
                  "version": "KqlParameterItem/1.0",
                  "name": "template_header",
                  "label": "Email Header",
                  "type": 1,
                  "isGlobal": true,
                  "query": "[concat('externaldata ( Config:string ) [\"', parameters('storageUrl') ,'/seen/templates/header.html',  parameters('storageSas') ,'\"] with(format=\"RAW\")')]",
                  "typeSettings": {
                    "multiLineText": true,
                    "editorLanguage": "text",
                    "multiLineHeight": 15
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "templates"
            },
            "customWidth": "50",
            "name": "GetTemplates"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "e434dab5-5ca5-43a5-9683-0573cfcc5779",
                  "version": "KqlParameterItem/1.0",
                  "name": "template_footer",
                  "label": "Email Footer",
                  "type": 1,
                  "isGlobal": true,
                  "query": "[concat('externaldata ( Config:string ) [\"', parameters('storageUrl') ,'/seen/templates/footer.html',  parameters('storageSas') ,'\"] with(format=\"RAW\")')]",
                "typeSettings": {
                    "multiLineText": true,
                    "editorLanguage": "text",
                    "multiLineHeight": 15
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "templates"
            },
            "customWidth": "50",
            "name": "GetTemplates - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "loadType": "always",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "8abd6c13-dc18-4d14-871b-535d321eed34",
                        "version": "KqlParameterItem/1.0",
                        "name": "template_mfa",
                        "label": "Email MFA",
                        "type": 1,
                        "isGlobal": true,
                        "query": "[concat('externaldata ( Config:string ) [\"', parameters('storageUrl') ,'/seen/templates/mfa.html',  parameters('storageSas') ,'\"] with(format=\"RAW\")')]",
                        "typeSettings": {
                          "multiLineText": true,
                          "editorLanguage": "text",
                          "multiLineHeight": 15
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "8c07ded4-5d62-448e-b137-ebb93cb5b22c",
                        "version": "KqlParameterItem/1.0",
                        "name": "template_mfa_test",
                        "type": 1,
                        "isGlobal": true,
                        "query": "let header = base64_decode_tostring(\"{template_header:base64}\");\r\nlet footer = base64_decode_tostring(\"{template_footer:base64}\");\r\nlet base = base64_decode_tostring(\"{template_mfa:base64}\");\r\nlet activities = \"<table><thead><tr><th>Time</th><th>Activity</th></tr></thead><tbody><tr><td>ðŸ“† 2000-01-02 03:04:05</td><td>TEST - Something happened</td></tr></tbody></table>\";\r\nlet body = replace_string(replace_string(replace_string(replace_string(replace_string(replace_string(base,strcat(\"{\",\"SupportEmail}\"),\"{CurrentConfig:$.contact.supportEmail}\"),strcat(\"{\",\"SupportPhoneNumber}\"),\"{CurrentConfig:$.contact.supportPhone}\"),strcat(\"{\",\"UserFirstName}\"),\"Test User\"),strcat(\"{\",\"Activities}\"),activities),strcat(\"{\",\"Footer}\"),footer),strcat(\"{\",\"Header}\"),header);\r\nprint body=body",
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "GetTemplatesMFA"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "toolbar",
                    "links": [
                      {
                        "id": "3dbf5bfd-2b70-451c-966c-bd16ef03f26f",
                        "cellValue": "",
                        "linkTarget": "ArmAction",
                        "linkLabel": "Test MFA email",
                        "subTarget": "Visible",
                        "postText": "Send a test message to {CurrentConfig:$.testEmail}",
                        "style": "link",
                        "icon": "Mail",
                        "linkIsContextBlade": true,
                        "armActionContext": {
                          "path": "[concat(parameters('SendEMailLAId'), '/triggers/manual/run')]",
                          "headers": [],
                          "params": [
                            {
                              "key": "api-version",
                              "value": "2016-06-01"
                            }
                          ],
                          "body": "{\r\n  \"body\":\"{template_mfa_test:escapejson}\",\r\n  \"importance\":\"high\",\r\n  \"mailFrom\":\"{CurrentConfig:$.mailFrom}\",\r\n  \"replyTo\":\"{CurrentConfig:$.mailFrom}\",\r\n  \"saveToSentItems\":false,\r\n  \"subject\":\"{CurrentConfig:$.modules.mfa.subject}\",\r\n  \"to\":\"{CurrentConfig:$.testEmail}\",\r\n  \"tracking\":\"testtemplate\"\r\n}",
                          "httpMethod": "POST",
                          "title": "Sending a test email to {CurrentConfig:$.testEmail}",
                          "description": "## You are about to send a test Email\n\n- From: **{CurrentConfig:$.mailFrom}**   \n- To: **{CurrentConfig:$.testEmail}**\n- Subject: **{CurrentConfig:$.modules.mfa.subject}**\n\nIt will be using the templates defined in this workbook.",
                          "actionName": "Sending a test email to {CurrentConfig:$.testEmail}",
                          "runLabel": "Send email"
                        }
                      }
                    ]
                  },
                  "name": "MFATemplateAction"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "templates"
            },
            "customWidth": "50",
            "name": "MFATemplateGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "6b830aca-894a-4332-8cd3-bf17ff3ef417",
                        "version": "KqlParameterItem/1.0",
                        "name": "template_tap",
                        "label": "Email TAP",
                        "type": 1,
                        "isGlobal": true,
                        "query": "[concat('externaldata ( Config:string ) [\"', parameters('storageUrl') ,'/seen/templates/tap.html',  parameters('storageSas') ,'\"] with(format=\"RAW\")')]",
                        "typeSettings": {
                          "multiLineText": true,
                          "editorLanguage": "text",
                          "multiLineHeight": 15
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "9dae8345-e6b9-45ee-b2b0-bc2dab32b436",
                        "version": "KqlParameterItem/1.0",
                        "name": "template_tap_test",
                        "type": 1,
                        "query": "let header = base64_decode_tostring(\"{template_header:base64}\");\r\nlet footer = base64_decode_tostring(\"{template_footer:base64}\");\r\nlet base = base64_decode_tostring(\"{template_tap:base64}\");\r\nlet activities = \"<table><thead><tr><th>Time</th><th>Activity</th></tr></thead><tbody><tr><td>ðŸ“† 2000-01-02 03:04:05</td><td>TEST - Something happened</td></tr></tbody></table>\";\r\nlet body = replace_string(replace_string(replace_string(replace_string(replace_string(replace_string(base,strcat(\"{\",\"SupportEmail}\"),\"{CurrentConfig:$.contact.supportEmail}\"),strcat(\"{\",\"SupportPhoneNumber}\"),\"{CurrentConfig:$.contact.supportPhone}\"),strcat(\"{\",\"UserFirstName}\"),\"Test User\"),strcat(\"{\",\"Activities}\"),activities),strcat(\"{\",\"Footer}\"),footer),strcat(\"{\",\"Header}\"),header);\r\nprint body = body",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "GetTemplatesTAP"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "toolbar",
                    "links": [
                      {
                        "id": "331214ca-b62f-4110-973e-b394efddce02",
                        "cellValue": "",
                        "linkTarget": "ArmAction",
                        "linkLabel": "Test TAP email",
                        "subTarget": "Visible",
                        "postText": "Send a test message to {CurrentConfig:$.testEmail}",
                        "style": "link",
                        "icon": "Mail",
                        "linkIsContextBlade": true,
                        "armActionContext": {
                          "path": "[concat(parameters('SendEMailLAId'), '/triggers/manual/run')]",
                          "headers": [],
                          "params": [
                            {
                              "key": "api-version",
                              "value": "2016-06-01"
                            }
                          ],
                          "body": "{\r\n  \"body\":\"{template_tap_test:escapejson}\",\r\n  \"importance\":\"high\",\r\n  \"mailFrom\":\"{CurrentConfig:$.mailFrom}\",\r\n  \"replyTo\":\"{CurrentConfig:$.mailFrom}\",\r\n  \"saveToSentItems\":false,\r\n  \"subject\":\"{CurrentConfig:$.modules.tap.subject}\",\r\n  \"to\":\"{CurrentConfig:$.testEmail}\",\r\n  \"tracking\":\"testtemplate\"\r\n}",
                          "httpMethod": "POST",
                          "title": "Sending a test email to {CurrentConfig:$.testEmail}",
                          "description": "## You are about to send a test Email\n\n- From: **{CurrentConfig:$.mailFrom}**   \n- To: **{CurrentConfig:$.testEmail}**\n- Subject: **{CurrentConfig:$.modules.tap.subject}**\n\nIt will be using the templates defined in this workbook.",
                          "actionName": "Sending a test email to {CurrentConfig:$.testEmail}",
                          "runLabel": "Send email"
                        }
                      }
                    ]
                  },
                  "name": "TAPTemplateAction"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "templates"
            },
            "customWidth": "50",
            "name": "TAPTemplateGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "loadType": "always",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "8abd6c13-dc18-4d14-871b-535d321eed34",
                        "version": "KqlParameterItem/1.0",
                        "name": "template_travel",
                        "label": "Email Travel",
                        "type": 1,
                        "isGlobal": true,
                        "query": "[concat('externaldata ( Config:string ) [\"', parameters('storageUrl') ,'/seen/templates/travel.html',  parameters('storageSas') ,'\"] with(format=\"RAW\")')]",
                        "typeSettings": {
                          "multiLineText": true,
                          "editorLanguage": "text",
                          "multiLineHeight": 15
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "8c07ded4-5d62-448e-b137-ebb93cb5b22c",
                        "version": "KqlParameterItem/1.0",
                        "name": "template_travel_test",
                        "type": 1,
                        "isGlobal": true,
                        "query": "let header = base64_decode_tostring(\"{template_header:base64}\");\r\nlet footer = base64_decode_tostring(\"{template_footer:base64}\");\r\nlet base = base64_decode_tostring(\"{template_travel:base64}\");\r\nlet activities = \"<table><thead><tr><th>Time</th><th>Activity</th></tr></thead><tbody><tr><td>ðŸ“† 2000-01-02 03:04:05</td><td>TEST - Something happened</td></tr></tbody></table>\";\r\nlet body = replace_string(replace_string(replace_string(replace_string(replace_string(replace_string(base,strcat(\"{\",\"SupportEmail}\"),\"{CurrentConfig:$.contact.supportEmail}\"),strcat(\"{\",\"SupportPhoneNumber}\"),\"{CurrentConfig:$.contact.supportPhone}\"),strcat(\"{\",\"UserFirstName}\"),\"Test User\"),strcat(\"{\",\"Activities}\"),activities),strcat(\"{\",\"Footer}\"),footer),strcat(\"{\",\"Header}\"),header);\r\nprint body=body",
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "GetTemplatesTravel"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "toolbar",
                    "links": [
                      {
                        "id": "3dbf5bfd-2b70-451c-966c-bd16ef03f26f",
                        "cellValue": "",
                        "linkTarget": "ArmAction",
                        "linkLabel": "Test Travel email",
                        "subTarget": "Visible",
                        "postText": "Send a test message to {CurrentConfig:$.testEmail}",
                        "style": "link",
                        "icon": "Mail",
                        "linkIsContextBlade": true,
                        "armActionContext": {
                          "path": "[concat(parameters('SendEMailLAId'), '/triggers/manual/run')]",
                          "headers": [],
                          "params": [
                            {
                              "key": "api-version",
                              "value": "2016-06-01"
                            }
                          ],
                          "body": "{\r\n  \"body\":\"{template_mfa_test:escapejson}\",\r\n  \"importance\":\"high\",\r\n  \"mailFrom\":\"{CurrentConfig:$.mailFrom}\",\r\n  \"replyTo\":\"{CurrentConfig:$.mailFrom}\",\r\n  \"saveToSentItems\":false,\r\n  \"subject\":\"{CurrentConfig:$.modules.travel.subject}\",\r\n  \"to\":\"{CurrentConfig:$.testEmail}\",\r\n  \"tracking\":\"testtemplate\"\r\n}",
                          "httpMethod": "POST",
                          "title": "Sending a test email to {CurrentConfig:$.testEmail}",
                          "description": "## You are about to send a test Email\n\n- From: **{CurrentConfig:$.mailFrom}**   \n- To: **{CurrentConfig:$.testEmail}**\n- Subject: **{CurrentConfig:$.modules.travel.subject}**\n\nIt will be using the templates defined in this workbook.",
                          "actionName": "Sending a test email to {CurrentConfig:$.testEmail}",
                          "runLabel": "Send email"
                        }
                      }
                    ]
                  },
                  "name": "TravelTemplateAction"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "templates"
            },
            "customWidth": "50",
            "name": "TravelTemplateGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "loadType": "always",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "8abd6c13-dc18-4d14-871b-535d321eed34",
                        "version": "KqlParameterItem/1.0",
                        "name": "template_version",
                        "label": "Version management",
                        "type": 1,
                        "isGlobal": true,
                        "query": "[concat('externaldata ( Config:string ) [\"', parameters('storageUrl') ,'/seen/templates/version.html',  parameters('storageSas') ,'\"] with(format=\"RAW\")')]",
                        "typeSettings": {
                          "multiLineText": true,
                          "editorLanguage": "text",
                          "multiLineHeight": 15
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "8c07ded4-5d62-448e-b137-ebb93cb5b22c",
                        "version": "KqlParameterItem/1.0",
                        "name": "template_version_test",
                        "type": 1,
                        "isGlobal": true,
                        "query": "let header = base64_decode_tostring(\"{template_header:base64}\");\r\nlet footer = base64_decode_tostring(\"{template_footer:base64}\");\r\nlet base = base64_decode_tostring(\"{template_travel:base64}\");\r\nlet activities = \"<table><thead><tr><th>Time</th><th>Activity</th></tr></thead><tbody><tr><td>ðŸ“† 2000-01-02 03:04:05</td><td>TEST - Something happened</td></tr></tbody></table>\";\r\nlet body = replace_string(replace_string(replace_string(replace_string(replace_string(replace_string(base,strcat(\"{\",\"SupportEmail}\"),\"{CurrentConfig:$.contact.supportEmail}\"),strcat(\"{\",\"SupportPhoneNumber}\"),\"{CurrentConfig:$.contact.supportPhone}\"),strcat(\"{\",\"UserFirstName}\"),\"Test User\"),strcat(\"{\",\"Activities}\"),activities),strcat(\"{\",\"Footer}\"),footer),strcat(\"{\",\"Header}\"),header);\r\nprint body=body",
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "GetTemplatesVersion"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "toolbar",
                    "links": [
                      {
                        "id": "3dbf5bfd-2b70-451c-966c-bd16ef03f26f",
                        "cellValue": "",
                        "linkTarget": "ArmAction",
                        "linkLabel": "Test Version email",
                        "subTarget": "Visible",
                        "postText": "Send a test message to {CurrentConfig:$.testEmail}",
                        "style": "link",
                        "icon": "Mail",
                        "linkIsContextBlade": true,
                        "armActionContext": {
                          "path": "[concat(parameters('SendEMailLAId'), '/triggers/manual/run')]",
                          "headers": [],
                          "params": [
                            {
                              "key": "api-version",
                              "value": "2016-06-01"
                            }
                          ],
                          "body": "{\r\n  \"body\":\"{template_travel_test:escapejson}\",\r\n  \"importance\":\"high\",\r\n  \"mailFrom\":\"{CurrentConfig:$.mailFrom}\",\r\n  \"replyTo\":\"{CurrentConfig:$.mailFrom}\",\r\n  \"saveToSentItems\":false,\r\n  \"subject\":\"{CurrentConfig:$.versionManagement.subject}\",\r\n  \"to\":\"{CurrentConfig:$.versionManagement.adminEmail}\",\r\n  \"tracking\":\"testtemplate\"\r\n}",
                          "httpMethod": "POST",
                          "title": "Sending a test email to {CurrentConfig:$.testEmail}",
                          "description": "## You are about to send a test Email\n\n- From: **{CurrentConfig:$.mailFrom}**   \n- To: **{CurrentConfig:$.versionManagement.adminEmail}**\n- Subject: **{CurrentConfig:$.versionManagement.subject}**\n\nIt will be using the templates defined in this workbook.",
                          "actionName": "Sending a test email to {CurrentConfig:$.testEmail}",
                          "runLabel": "Send email"
                        }
                      }
                    ]
                  },
                  "name": "VersionTemplateAction"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "templates"
            },
            "customWidth": "50",
            "name": "VersionTemplateGroup"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "toolbar",
              "links": [
                {
                  "id": "6c3db8a8-6422-4499-b99a-cedcb28d332e",
                  "linkTarget": "ArmAction",
                  "linkLabel": "Save all templates",
                  "style": "link",
                  "icon": "SaveAll",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "[concat(parameters('ConfigLAId'), '/triggers/manual/run')]",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2016-06-01"
                      }
                    ],
                    "body": "{\r\n  \"module\":\"templates\",\r\n  \"templates\": {\r\n    \"header\":\"{template_header:base64}\",\r\n    \"footer\":\"{template_footer:base64}\",\r\n    \"mfa\":\"{template_mfa:base64}\",\r\n    \"tap\":\"{template_tap:base64}\",\r\n    \"version\":\"{template_version:base64}\",\r\n    \"travel\":\"{template_travel:base64}\"\r\n  }\r\n}",
                    "httpMethod": "POST",
                    "title": "Updating HTML templates",
                    "description": "### Updating templates\n\nYou are about to update ALL templates for the solution.\n\nPlease double check your entries.",
                    "actionName": "Updating HTML templates",
                    "runLabel": "Updating all templates"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "VisibleTab",
              "comparison": "isEqualTo",
              "value": "templates"
            },
            "name": "UpdateTemplates"
          }
        ],
        "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
      }
   },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "[string(variables('workbookContent'))]",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}
